# 编写一个内核模块求最大值

## 题目介绍

本题目要求编写一个Linux内核模块，该模块能够接收一个整数数组作为输入，计算并输出数组中所有元素的最大值。这是一个很好的练习，可以帮助理解Linux内核模块的编写和基本的数组操作。

本题可参考[第五章 Linux内核模块](../chapter_2.md)中的[编写一个简单的内核模块](../chapter_2_1.md)与[内核模块传参](../chapter_2_2.md)

## 题目要求

- 编写一个内核模块。
- 接收一个以逗号分隔的整数字符串作为输入。
- 计算输入数组中的最大值。
- 输出结果。

## 输入

- 一个以逗号分隔的整数字符串，例如："8,3,12,6,20"

## 输出

- 数组中的最大值，对于上述输入，输出应为：20

## 示例

- 输入：[8, 3, 12, 6, 20]
- 输出：20

## 代码介绍

1. **max_value.c** 文件包含了内核模块的实现。
   - 定义了模块参数 `input_str`，用于接收输入的字符串。
   - 实现了 `parse_input` 函数，用于解析字符串并填充到整数数组 `arr` 中。
   - 实现了 `max_value` 函数，用于找出数组中的最大值，但当前实现尚未完成。

2. 模块初始化函数 `max_init` 在模块加载时执行，调用 `parse_input` 和 `max_value` 函数，并打印最大值。

3. 模块退出函数 `max_exit` 在模块卸载时执行，打印卸载信息。

## 详细提示信息

- **max_value 函数实现**：
  - 需要遍历整个数组，使用一个变量记录最大值。
  - 与数组中的每个元素比较，并更新最大值。

- **parse_input 函数**：
  - 使用 `strsep` 和 `kstrtoint` 函数解析字符串。
  - 将解析后的整数填充到数组 `arr` 中，并记录数组大小 `arr_size`。

- **模块参数**：
  - 使用 `module_param` 定义了 `input_str` 参数。
  - 使用 `MODULE_PARM_DESC` 提供了参数的描述。

- **内存管理**：
  - 使用 `kstrdup` 和 `kfree` 管理内存，避免内存泄漏。

- **错误处理**：
  - 对于输入字符串为空或解析失败的情况，模块初始化函数返回 `-EINVAL`。

## 注意事项

- 确保 `max_value` 函数正确实现最大值查找逻辑。
- 注意模块参数的使用和内存管理。
- 考虑使用内核日志函数 `printk` 进行适当的错误和信息输出。
- 参与者需要根据题目要求，完成 `max_value` 函数的实现，确保内核模块能够正确地找出并输出数组中的最大值。同时，注意代码的健壮性和内存管理。通过内核模块的编写和测试，加深对Linux内核模块开发的理解。
