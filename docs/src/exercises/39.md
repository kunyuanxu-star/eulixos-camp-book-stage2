# 编写一个内核模块实现一个简单的文件操作函数

## 题目介绍

本题目要求编写一个Linux内核模块，实现对文件的基本操作，包括打开、读取、写入和关闭文件。这是一个基础练习，有助于理解Linux内核模块中文件操作的实现方式。

本题可参考[第五章 Linux内核模块](../chapter-5.md)中的[实现简单文件操作](../chapter-5_5.md)

## 题目要求

- 编写一个内核模块。
- 实现文件的打开、读取、写入、关闭操作。
- 在控制台输出操作结果。

## 输入

无特定输入要求。

## 输出

- 成功打开文件时输出：`File operation successful`
- 打开失败时输出：`Failed to open file`

## 代码介绍

1. **fileop.c** 文件包含了内核模块的实现。
   - 定义了文件名 `FILE_NAME` 和用于操作的文件指针 `file_ptr`。

2. 模块初始化函数 `fileop_init` 在模块加载时执行，需要在这里实现文件操作逻辑。

3. 模块退出函数 `fileop_exit` 在模块卸载时执行，关闭文件并打印信息。

## 详细提示信息

- **文件操作**：
  - 使用 `filp_open` 函数尝试打开文件，该函数需要文件名、访问模式和其他标志。
  - 检查 `filp_open` 的返回值，如果成功，将返回的 `struct file *` 指针赋值给 `file_ptr`。

- **读取和写入文件**：
  - 如果需要，使用 `vfs_read` 或 `vfs_write` 函数实现文件的读取和写入操作。

- **错误处理**：
  - 如果文件打开失败，打印错误信息。

- **模块初始化和退出**：
  - 在 `fileop_init` 中实现文件操作，并根据操作结果打印相应信息。
  - 在 `fileop_exit` 中检查 `file_ptr` 是否非空，如果是，则调用 `filp_close` 关闭文件，并打印关闭信息。

- **内核日志**：
  - 使用 `printk` 函数根据不同情况打印内核日志信息。

## 注意事项

- 确保正确处理文件打开操作的成功与失败。
- 注意模块的初始化和退出函数中文件操作的完整性。
- 使用内核日志函数 `printk` 进行适当的信息输出。
- 参与者需要根据题目要求，完成文件操作的实现，确保能够正确打开文件并在适当的时候关闭文件。通过编写内核模块，加深对Linux内核文件操作的理解，并掌握内核模块的编写和测试流程。
